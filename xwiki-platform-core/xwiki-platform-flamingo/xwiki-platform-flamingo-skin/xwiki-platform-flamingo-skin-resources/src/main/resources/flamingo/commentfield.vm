## ---------------------------------------------------------------------------
## See the NOTICE file distributed with this work for additional
## information regarding copyright ownership.
##
## This is free software; you can redistribute it and/or modify it
## under the terms of the GNU Lesser General Public License as
## published by the Free Software Foundation; either version 2.1 of
## the License, or (at your option) any later version.
##
## This software is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
## Lesser General Public License for more details.
##
## You should have received a copy of the GNU Lesser General Public
## License along with this software; if not, write to the Free
## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
## 02110-1301 USA, or see the FSF site: http://www.fsf.org.
## ---------------------------------------------------------------------------
###
### Return a single comment field
###
###
## requested field name 
#set ($name = $request.name)

## the 'comment' field from the XWikiComments class is used as a template for the field to display
#set($xCommentClass = 'XWiki.XWikiComments')
#set($commentClass = $xwiki.getDocument($xCommentClass).getxWikiClass())

## the number of the comment, if no number is provided we generate a field for a new comment.
#set ($number = $numbertool.toNumber($request.number).intValue())

## the number of the comment, if no number is provided we generate a field for a new comment.
#if ($number && $number > -1)
    #set ($commentObj = $doc.getObject($xCommentClass, $number))
    #set ($value = $commentObj.getValue('comment'))
#else
    #set ($commentObj = $doc.newObject($xCommentClass))
    #set ($value = '')
#end

## copy and rename to the requested name of the comment field
#set ($ocls = $commentObj.getxWikiClass())
#set ($discard = $ocls.getXWikiClass().put($name, $commentClass.getXWikiClass().get('comment')))
#set ($discard = $ocls.getXWikiClass().get($name).setName($name))
#set ($ppt = $ocls.get($name))

## attribution of the value to the new field in the object. 
#set ($discard = $commentObj.set($name, $value))

## display of the comment field
$doc.displayEdit($ppt, '', $commentObj)

#set ($discard = $ocls.getXWikiClass().removeField($name))